# Copyright (c) 2025 MikeT LLC. All rights reserved.

---
# =============================================================================
# ATOM HOST CONFIGURATION
# =============================================================================
#
# Fedora Server - Basecamp / Hacker Node (Battery-Backed)
#
# OS:       Fedora Server 43 (graphical.target with Sway/i3)
# Hardware: Lenovo ThinkPad X1 Carbon (2012)
# CPU:      Intel Core i7-3667U (2C/4T)
# RAM:      8GB
# Storage:  224GB SSD
# GPU:      Intel HD Graphics 4000 (integrated)
#
# Role:     Basecamp / Hacker Node
#           Lightweight tiling WM environment for:
#           - Network analysis and security research
#           - SDR and RF experimentation
#           - Serial communication and LoRa development
#           - Field-portable appliance mode
#
# Design:   Low-resource, stable, predictable, secure
#           Both Sway (Wayland) and i3 (X11) available
#           Battery-backed = implicit UPS
#           100% managed via IaC
#
# Migration: Converted from headless resilience node 2025-12
#
# =============================================================================

# ========================================
# Device Identity
# ========================================
device_role: basecamp_node
device_description: "Battery-backed basecamp/hacker node for field operations and security research"

# Basecamp operation flag - triggers graphical session
basecamp: true
headless: false

# Tailscale identity (from miket-infra)
tailscale_ip: 100.120.122.13
tailscale_hostname: atom.pangolin-vega.ts.net

# ========================================
# Ansible Connection
# ========================================
# Uses Tailscale SSH - password from AKV
ansible_host: atom.pangolin-vega.ts.net
ansible_user: mdt
ansible_become: true
ansible_python_interpreter: /usr/bin/python3

# Password lookup from Azure Key Vault (per miket-infra invariants)
ansible_password: "{{ lookup('pipe', '/usr/bin/az keyvault secret show --vault-name kv-miket-ops --name atom-ansible-password --query value -o tsv') | trim }}"

# ========================================
# Basecamp User Configuration
# ========================================
basecamp_user: mdt
basecamp_user_home: /home/mdt

# ========================================
# Basecamp UI Configuration
# ========================================
basecamp_ui_user: mdt
basecamp_ui_user_home: /home/mdt

# Display manager (greetd with SDDM fallback)
basecamp_ui_display_manager: greetd
basecamp_ui_greetd_vt: 1

# Boot target
basecamp_ui_boot_target: graphical.target

# Touchscreen support
basecamp_ui_touchscreen_enabled: true

# ========================================
# Power Management (Battery-Backed)
# ========================================
# Critical for basecamp role - never sleep unexpectedly

# Battery thresholds
resilience_node_low_battery_warning: 5
resilience_node_critical_battery_percent: 2
resilience_node_critical_battery_action: shutdown

# Lid switch behavior - stay running
resilience_node_lid_switch: ignore
resilience_node_lid_switch_external_power: ignore
resilience_node_lid_switch_docked: ignore

# Idle behavior - never sleep
resilience_node_idle_action: ignore
resilience_node_idle_action_sec: 0

# ========================================
# Hardware Constraints
# ========================================
# Document what this device CANNOT do

# No GPU compute - Intel integrated only
gpu:
  vendor: Intel
  model: HD Graphics 4000
  compute_capable: false

# Low memory - be selective about running services
memory_gb: 8
cpu_cores: 2
cpu_threads: 4

# Performance targets
basecamp_target_idle_ram_mb: 800
basecamp_target_boot_time_sec: 30

# ========================================
# SDR Configuration
# ========================================
basecamp_tools_sdr_enabled: true
# SDRangel disabled due to resource constraints
basecamp_tools_install_sdrangel: false
# Wireshark GUI disabled - use tshark CLI
basecamp_tools_install_wireshark_gui: false

# ========================================
# Monitoring Configuration
# ========================================
node_exporter_enabled: true
resilience_node_exporter_enabled: true
resilience_node_exporter_port: 9100

# ========================================
# Firewall Configuration
# ========================================
resilience_node_firewall_ports:
  - 9100/tcp    # node_exporter (Prometheus)

# Firewalld tailnet configuration
tailnet_cidr: "100.64.0.0/10"
tailscale_interface: tailscale0
firewalld_tailnet_zone: tailnet
firewalld_default_zone: public
tailnet_services:
  - ssh
tailnet_ports:
  - port: 9100
    protocol: tcp

# ========================================
# Services (Minimal by Design)
# ========================================
atom_services:
  - prometheus-node-exporter   # Metrics for Prometheus
  - tailscaled                 # Tailscale daemon
  - firewalld                  # Firewall
  - greetd                     # Display manager (or sddm as fallback)

# ========================================
# Disabled Features
# ========================================
# NOT a container host
podman_enabled: false
docker_enabled: false

# NOT running AI workloads
vllm_enabled: false
litellm_enabled: false

# NOT providing storage
smb_enabled: false
nfs_enabled: false

# NOT mounting network shares (resilience principle)
# CIFS mounts removed per 2024-12-01 incident

# Disable heavy workstation GUI tools (use basecamp UI instead)
workstation_gui_tools_enabled: false
vscode_enabled: false
cursor_enabled: false
warp_enabled: false

# ========================================
# SELinux Configuration
# ========================================
selinux_notes: |
  sshd_t domain is in permissive mode for Tailscale SSH.
  This is accepted technical debt - Tailscale SSH uses a non-standard
  mechanism that SELinux's sshd_t policy doesn't anticipate.

  Risk: Low - only accessible via tailnet
  Future: Create custom policy module if AVC denials cause issues

# ========================================
# Tags (defined in miket-infra)
# ========================================
tailscale_tags:
  - tag:server
  - tag:linux
  - tag:basecamp
  - tag:portable

tailscale_auth_key_akv_secret: tailscale-auth-key-atom
tailscale_join_tags: "tag:server,tag:linux"
