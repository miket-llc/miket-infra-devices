# Copyright (c) 2025 MikeT LLC. All rights reserved.

---
# Deploy Nextcloud Desktop Client to Endpoints
#
# Usage:
#   # All endpoints
#   ansible-playbook playbooks/deploy-nextcloud-client.yml
#
#   # Specific host
#   ansible-playbook playbooks/deploy-nextcloud-client.yml --limit count-zero
#
#   # Windows only
#   ansible-playbook playbooks/deploy-nextcloud-client.yml --limit windows_workstations

- name: Deploy Nextcloud Client to macOS
  hosts: macos
  become: false
  gather_facts: true

  pre_tasks:
    - name: Display macOS deployment info
      ansible.builtin.debug:
        msg: |
          Deploying Nextcloud client to {{ inventory_hostname }}
          Server: https://nextcloud.miket.io
          Sync Root: ~/nc

  roles:
    - role: ../roles/nextcloud_client
      vars:
        nextcloud_sync_root: "{{ ansible_user_dir }}/nc"

- name: Deploy Nextcloud Client to Windows
  hosts: windows_workstations
  gather_facts: true

  pre_tasks:
    - name: Display Windows deployment info
      ansible.builtin.debug:
        msg: |
          Deploying Nextcloud client to {{ inventory_hostname }}
          Server: https://nextcloud.miket.io
          Sync Root: %USERPROFILE%\nc

  roles:
    - role: ../roles/nextcloud_client
      vars:
        nextcloud_sync_root: "{{ ansible_user_dir }}\\nc"

- name: Deploy Nextcloud Client to Linux (non-server)
  hosts: linux:!linux_servers
  become: true
  gather_facts: true

  pre_tasks:
    - name: Display Linux deployment info
      ansible.builtin.debug:
        msg: |
          Deploying Nextcloud client to {{ inventory_hostname }}
          Server: https://nextcloud.miket.io
          Sync Root: ~/nc

  roles:
    - role: ../roles/nextcloud_client
      vars:
        nextcloud_sync_root: "{{ ansible_user_dir }}/nc"

- name: Display post-deployment instructions
  hosts: all:!linux_servers
  gather_facts: false

  tasks:
    - name: Post-deployment summary
      ansible.builtin.debug:
        msg: |
          ═══════════════════════════════════════════════════════════
          NEXTCLOUD CLIENT DEPLOYMENT COMPLETE
          ═══════════════════════════════════════════════════════════
          
          Host: {{ inventory_hostname }}
          
          MANUAL SETUP REQUIRED:
          1. Launch Nextcloud application
          2. Click "Log in to your Nextcloud"
          3. Enter: https://nextcloud.miket.io
          4. Authenticate via Cloudflare Access (Entra ID)
          5. Select local sync folder: ~/nc
          6. Choose folders to sync:
             ✅ work, media, finance, inbox, assets, camera
             ⚡ ms365 (online-only recommended)
          
          NEVER sync these to Nextcloud:
          ❌ Pro Tools / DAW sessions
          ❌ Video editing projects
          ❌ Lightroom/Photoshop catalogs
          ❌ Git repos, node_modules
          
          See: docs/guides/nextcloud_client_usage.md
          ═══════════════════════════════════════════════════════════

