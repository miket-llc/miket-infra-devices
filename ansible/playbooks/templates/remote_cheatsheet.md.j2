# Remote Desktop Connection Cheatsheet

Generated: {{ ansible_date_time.iso8601 }}

## Overview

This cheatsheet provides quick connection information for all hosts in the tailnet. All connections use Tailscale MagicDNS and are restricted to the Tailscale network (100.64.0.0/10).

## Connection Methods

### Linux Clients
- **RDP**: `remmina` GUI or `rdp HOSTNAME`
- **VNC**: `remmina` GUI or `vnc HOSTNAME`
- **Examples**: `rdp wintermute`, `vnc motoko`

### Windows Clients
- **RDP**: `mstsc /v:HOSTNAME.tail2e55fe.ts.net:3389`
- **VNC**: RealVNC, TightVNC, or `vnc HOSTNAME`
- **Examples**: `mstsc /v:wintermute.tail2e55fe.ts.net`, `vnc motoko`

### macOS Clients
- **RDP**: Microsoft Remote Desktop or `rdp HOSTNAME`
- **VNC**: Screen Sharing (`Cmd+K` â†’ `vnc://HOSTNAME.tail2e55fe.ts.net`)
- **Examples**: `rdp wintermute`, `vnc count-zero`

## Host Connections

{% for host in groups['all'] %}
{% if host != 'localhost' %}
{% set protocol = hostvars[host].remote_protocol | default('rdp') %}
{% set port = hostvars[host].remote_port | default(3389) %}
{% set quick = 'rdp' if protocol == 'rdp' else 'vnc' %}
### {{ host | upper }}

- **Hostname**: `{{ host }}.tail2e55fe.ts.net` (MagicDNS)
- **Protocol**: {{ protocol | upper }}
- **Port**: {{ port }}
- **Connection**: `{{ protocol }}://{{ host }}.tail2e55fe.ts.net:{{ port }}`
- **Quick Connect**: `{{ quick }} {{ host }}`
{% if hostvars[host].desktop_env is defined %}
- **Desktop Environment**: {{ hostvars[host].desktop_env }}
{% endif %}
{% if hostvars[host].display_server is defined %}
- **Display Server**: {{ hostvars[host].display_server }}
{% endif %}

{% endif %}
{% endfor %}

## Troubleshooting

### Connection Issues

1. **Verify Tailscale connectivity**:
   ```bash
   ping HOSTNAME.tail2e55fe.ts.net
   ```

2. **Check firewall rules**:
   - Linux: `sudo ufw status` or `sudo firewall-cmd --list-all`
   - Windows: `Get-NetFirewallRule -Name "*RDP*"`

3. **Verify service is running**:
   - Linux: `systemctl status xrdp`
   - Windows: `Get-Service TermService`

### Wayland Issues (Linux)

If you're on Wayland and RDP doesn't work:
1. Switch to Xorg session at login
2. Or configure xorgxrdp for Wayland compatibility
3. See README for detailed instructions

### Blank Screen Fixes

- Ensure desktop environment is running
- Check xrdp logs: `sudo journalctl -u xrdp -n 50`
- Verify Xorg session is configured: `/usr/share/xsessions/Xorg.desktop`

### Firewall Checks

- **Linux**: Ensure port 3389 (or configured port) is open on Tailscale interface
- **Windows**: Verify RDP firewall rule allows Tailscale subnet (100.64.0.0/10)

## Security Notes

- All connections are restricted to Tailscale network (100.64.0.0/10)
- No public ports are exposed
- **MagicDNS**: Use `.tail2e55fe.ts.net` hostnames for automatic resolution
- Network Level Authentication (NLA) enabled on Windows hosts

## Quick Reference

| Host | Protocol | Port | Command |
|------|----------|------|---------|
{% for host in groups['all'] %}
{% if host != 'localhost' %}
{% set protocol = hostvars[host].remote_protocol | default('rdp') %}
{% set port = hostvars[host].remote_port | default(3389) %}
{% set quick = 'rdp' if protocol == 'rdp' else 'vnc' %}
| {{ host }} | {{ protocol }} | {{ port }} | `{{ quick }} {{ host }}` |
{% endif %}
{% endfor %}

