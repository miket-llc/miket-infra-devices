# Remote Desktop Connection Cheatsheet

Generated: {{ ansible_date_time.iso8601 }}

## Overview

This cheatsheet provides quick connection information for all hosts in the tailnet. All connections use Tailscale MagicDNS and are restricted to the Tailscale network (100.64.0.0/10).

**NoMachine is the sole remote desktop solution** (RDP/VNC architecturally retired 2025-11-22).

## Connection Methods

### Linux Clients
- **GUI**: Launch NoMachine client (`nxplayer` or Applications menu)
- **CLI**: `nomachine HOSTNAME` or `/usr/NX/bin/nxplayer --session HOSTNAME.pangolin-vega.ts.net:4000`
- **Example**: `nomachine motoko`

### Windows Clients
- **GUI**: Start Menu > NoMachine
- **CLI**: `nomachine HOSTNAME` or `"C:\Program Files\NoMachine\bin\nxplayer.exe" --session HOSTNAME.pangolin-vega.ts.net:4000`
- **Example**: `nomachine motoko`

### macOS Clients
- **GUI**: `/Applications/NoMachine.app`
- **CLI**: `nomachine HOSTNAME` or `/Applications/NoMachine.app/Contents/MacOS/nxplayer --session HOSTNAME.pangolin-vega.ts.net:4000`
- **Example**: `nomachine motoko`

## Host Connections

{% for host in groups['all'] %}
{% if host != 'localhost' %}
### {{ host | upper }}

- **Hostname**: `{{ host }}.pangolin-vega.ts.net` (MagicDNS)
- **Protocol**: NoMachine
- **Port**: {{ hostvars[host].nomachine_port | default(4000) }}
- **Connection**: `{{ host }}.pangolin-vega.ts.net:{{ hostvars[host].nomachine_port | default(4000) }}`
- **Quick Connect**: `nomachine {{ host }}`
{% if hostvars[host].desktop_env is defined %}
- **Desktop Environment**: {{ hostvars[host].desktop_env }}
{% endif %}
{% if hostvars[host].display_server is defined %}
- **Display Server**: {{ hostvars[host].display_server }}
{% endif %}

{% endif %}
{% endfor %}

## Troubleshooting

### Connection Issues

1. **Verify Tailscale connectivity**:
   ```bash
   ping {{ host }}.pangolin-vega.ts.net
   ```

2. **Check firewall rules**:
   - Linux: `sudo ufw status | grep 4000`
   - Windows: `Get-NetFirewallRule -Name "*NoMachine*"`

3. **Verify NoMachine service is running**:
   - Linux: `systemctl status nxserver`
   - Windows: `Get-Service nxservice`
   - macOS: Check NoMachine.app is running

### NoMachine Service Issues

- **Linux**: Check logs: `sudo journalctl -u nxserver -n 50`
- **Windows**: Check Event Viewer > Applications and Services Logs > NoMachine
- **macOS**: Check Console.app for NoMachine errors

### Firewall Checks

- **Linux**: Ensure port 4000 is open on Tailscale interface: `sudo ufw allow from 100.64.0.0/10 to any port 4000`
- **Windows**: Verify NoMachine firewall rule allows Tailscale subnet (100.64.0.0/10)
- **macOS**: Check System Preferences > Security & Privacy > Firewall

## Security Notes

- All connections are restricted to Tailscale network (100.64.0.0/10)
- No public ports are exposed
- **MagicDNS**: Use `.pangolin-vega.ts.net` hostnames for automatic resolution
- NoMachine uses encrypted connections by default

## Quick Reference

| Host | Protocol | Port | Command |
|------|----------|------|---------|
{% for host in groups['all'] %}
{% if host != 'localhost' %}
| {{ host }} | NoMachine | {{ hostvars[host].nomachine_port | default(4000) }} | `nomachine {{ host }}` |
{% endif %}
{% endfor %}
