---
# Deploy OpenAI Codex CLI to all nodes
# 
# Prerequisites:
# - Tailscale must be installed and connected (manual prerequisite)
# - WSL2 with Ubuntu required for Windows nodes (manual prerequisite)
#
# Usage:
#   ansible-playbook -i inventory/hosts.yml playbooks/deploy-codex-cli.yml
#
#   # Deploy to specific host
#   ansible-playbook -i inventory/hosts.yml playbooks/deploy-codex-cli.yml --limit motoko
#
#   # Test with timeout
#   timeout 300 ansible-playbook -i inventory/hosts.yml playbooks/deploy-codex-cli.yml --limit motoko

- name: Deploy OpenAI Codex CLI
  hosts: tailnet_all
  gather_facts: yes
  
  pre_tasks:
    - name: Display deployment info
      ansible.builtin.debug:
        msg: |
          Deploying Codex CLI to {{ inventory_hostname }}
          - OS: {{ ansible_os_family }}
          - Node.js 18+ required
          - Windows: Will install in WSL2 Ubuntu
  
  roles:
    - codex_cli
  
  post_tasks:
    - name: Deployment complete
      ansible.builtin.debug:
        msg: |
          âœ… Codex CLI deployment complete on {{ inventory_hostname }}!
          - Run 'codex' to authenticate and start using
          - Windows: Use 'wsl -d Ubuntu-24.04 -- codex' or enter WSL2 shell first
