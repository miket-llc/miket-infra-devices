---
# Deploy OpenSSH Server on Windows workstations
# Enables SSH access via Tailscale network for wintermute and armitage
#
# Usage:
#   ansible-playbook -i inventory/hosts.yml playbooks/deploy-openssh-windows.yml
#   ansible-playbook -i inventory/hosts.yml playbooks/deploy-openssh-windows.yml --limit wintermute

- name: Deploy OpenSSH Server on Windows
  hosts: windows_workstations
  gather_facts: no

  roles:
    - role: openssh_windows

  post_tasks:
    - name: Verify SSH is accessible
      ansible.builtin.wait_for:
        host: "{{ inventory_hostname }}.pangolin-vega.ts.net"
        port: 22
        timeout: 10
      delegate_to: localhost
      ignore_errors: yes
      register: ssh_check

    - name: SSH accessibility status
      ansible.builtin.debug:
        msg: "{{ '✅ SSH accessible' if ssh_check is succeeded else '⚠️ SSH not accessible from motoko - check firewall' }}"

