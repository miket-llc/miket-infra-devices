---
# Setup SSH access for count-zero
# Uses the existing SSH key from motoko's filesystem
# This follows the same pattern as standardize-users.yml

- name: Setup SSH access for count-zero
  hosts: count-zero
  gather_facts: false
  vars:
    infrastructure_ssh_key: "{{ lookup('file', '~/.ssh/id_ed25519.pub') }}"
    
  tasks:
    - name: Ensure .ssh directory exists
      file:
        path: ~/.ssh
        state: directory
        mode: '0700'
    
    - name: Add motoko's SSH public key to authorized_keys
      authorized_key:
        user: "{{ ansible_user }}"
        key: "{{ infrastructure_ssh_key }}"
        state: present
        comment: "motoko control node - {{ ansible_date_time.date }}"
    
    - name: Verify SSH access
      ping:
      register: ping_result
    
    - name: Display success message
      debug:
        msg:
          - "âœ… SSH access configured for count-zero"
          - "Key deployed from motoko: ~/.ssh/id_ed25519.pub"
          - "Test with: ssh {{ ansible_user }}@{{ ansible_host }}"

