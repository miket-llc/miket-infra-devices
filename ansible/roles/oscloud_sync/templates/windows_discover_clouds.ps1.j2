# Auto-generated by Ansible
# Discovers OS cloud storage roots on Windows

function Write-Log {
    param($Message)
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    Write-Output "[$timestamp] $Message"
}

Write-Log "Discovering OS cloud storage locations..."

# Output as JSON-like object
$clouds = @{
    hostname = $env:COMPUTERNAME
    username = $env:USERNAME
    timestamp = (Get-Date -Format "yyyy-MM-ddTHH:mm:ssZ")
}

# OneDrive Personal
$oneDrivePersonal = "$env:USERPROFILE\OneDrive"
if (Test-Path $oneDrivePersonal) {
    Write-Log "Found OneDrive Personal: $oneDrivePersonal"
    $clouds.onedrive_personal = $oneDrivePersonal
}

# OneDrive Business (dynamic discovery)
$oneDriveBusiness = Get-ChildItem "$env:USERPROFILE\OneDrive - *" -Directory -ErrorAction SilentlyContinue | Select-Object -First 1
if ($oneDriveBusiness) {
    Write-Log "Found OneDrive Business: $($oneDriveBusiness.FullName)"
    $clouds.onedrive_business = $oneDriveBusiness.FullName
    
    # Extract org name
    if ($oneDriveBusiness.Name -match "OneDrive - (.+)") {
        $clouds.onedrive_business_org = $matches[1]
    }
}

# iCloud Drive (if installed)
$iCloudPath = "$env:USERPROFILE\iCloudDrive"
if (Test-Path $iCloudPath) {
    Write-Log "Found iCloud Drive: $iCloudPath"
    $clouds.icloud = $iCloudPath
}

# Output as JSON
$clouds | ConvertTo-Json

Write-Log "Discovery complete."

