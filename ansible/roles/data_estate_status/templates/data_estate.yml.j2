# Data Estate Configuration
# Generated by Ansible from miket-infra-devices data_estate_status role
# Source: miket-infra DATA_ESTATE_SPEC.md

---
# Feature Enablement
# Components set to false will report NOT_CONFIGURED (neutral) instead of WARNING/CRITICAL
enabled:
  restic: {{ data_estate_restic_enabled | lower }}
  nextcloud_db: {{ data_estate_nextcloud_db_enabled | lower }}
  m365: {{ data_estate_m365_enabled | lower }}
  space_mirror: {{ data_estate_space_mirror_enabled | lower }}

# SLO Thresholds
slos:
  space_mirror_max_age_hours: {{ data_estate_slo_space_mirror_max_age_hours }}
  space_mirror_warning_age_hours: {{ data_estate_slo_space_mirror_warning_age_hours }}
  space_mirror_max_gap_percent: {{ data_estate_slo_space_mirror_max_gap_percent }}
  space_mirror_warning_gap_percent: {{ data_estate_slo_space_mirror_warning_gap_percent }}
  restic_snapshot_max_age_hours: {{ data_estate_slo_restic_snapshot_max_age_hours }}
  restic_snapshot_warning_age_hours: {{ data_estate_slo_restic_snapshot_warning_age_hours }}
  nextcloud_db_dump_max_age_hours: {{ data_estate_slo_nextcloud_db_dump_max_age_hours }}
  nextcloud_db_dump_warning_age_hours: {{ data_estate_slo_nextcloud_db_dump_warning_age_hours }}
  m365_ingestion_max_age_hours: {{ data_estate_slo_m365_ingestion_max_age_hours }}
  m365_ingestion_warning_age_hours: {{ data_estate_slo_m365_ingestion_warning_age_hours }}

# Data Assets
data_assets:
  - name: space_sor
    description: "System of Record - all critical data"
    source_path: /space
    cloud_targets:
      - type: b2_mirror
        bucket: {{ data_estate_b2_mirror_bucket }}
        sync_mode: rclone_sync
  - name: flux_runtime
    description: "Runtime workloads - hot data"
    source_path: /flux
    cloud_targets:
      - type: restic
        repo: b2:miket-backups-restic:flux
  - name: nextcloud_db
    description: "Nextcloud PostgreSQL database dumps"
    source_path: {{ data_estate_nextcloud_db_backup_path }}
    cloud_targets:
      - type: included_in_space_mirror
  - name: m365_ingestion
    description: "One-way ingestion from Microsoft 365"
    source_path: {{ data_estate_m365_ingestion_path }}
    ingestion_source: onedrive-business

# Restic Repositories
restic_repos:
{% for repo in data_estate_restic_repos %}
  - name: {{ repo.name }}
    repo: "{{ repo.repo }}"
    description: "{{ repo.description }}"
    use_cloud_credentials: {{ repo.use_cloud_credentials | lower }}
{% if repo.password_file is defined %}
    password_file: "{{ repo.password_file }}"
{% endif %}
{% endfor %}

# B2 Mirror Configuration
b2_mirror:
  bucket: {{ data_estate_b2_mirror_bucket }}
  source: {{ data_estate_b2_mirror_source }}

# Service Names (for journal log parsing)
services:
  space_mirror: {{ data_estate_service_space_mirror }}
  flux_backup: {{ data_estate_service_flux_backup }}
  flux_local: {{ data_estate_service_flux_local }}
  m365_sync: {{ data_estate_service_m365_sync }}
  db_backup: {{ data_estate_service_db_backup }}

# Dashboard Configuration
dashboard:
  output_path: {{ data_estate_markdown_output_dir }}
  files:
    json: status.json
    markdown: data-estate-status.md
  update_schedule: "{{ data_estate_timer_schedule }}"

# rclone Configuration
rclone:
  config_path: "{{ data_estate_rclone_config_path }}"

