# Copyright (c) 2025 MikeT LLC. All rights reserved.

---
# =============================================================================
# NETDATA ROLE DEFAULTS
# =============================================================================
#
# Netdata Cloud-centric monitoring topology (Homelab subscription)
#
# Architecture:
#   - Each node runs a standalone Netdata Agent
#   - All agents are claimed to Netdata Cloud (Homelab Space) via ACLK
#   - Netdata Cloud is the primary/unified monitoring UI
#   - Local dashboards are secondary (break-glass, tailnet-only)
#   - NO parent/child streaming - Cloud handles aggregation
#
# =============================================================================

# ========================================
# Netdata Cloud Configuration
# ========================================
# IMPORTANT: We use Netdata Cloud (Homelab plan) as the primary UI.
# All agents connect to Cloud via ACLK for unified monitoring.

# Enable Netdata Cloud connectivity (ACLK)
netdata_cloud_enabled: true

# Claim token for registering agents with Cloud
# Sourced from AKV secret: netdata-cloud-claim-token
# This is a SECRET - should be in AKV, but using env fallback for initial deploy
netdata_cloud_claim_token: "{{ lookup('env', 'NETDATA_CLOUD_CLAIM_TOKEN') | default('') }}"

# Rooms to claim the agent into
netdata_cloud_rooms: "{{ lookup('env', 'NETDATA_CLOUD_ROOMS') | default('') }}"

# Claim URL (Netdata Cloud)
netdata_cloud_claim_url: "https://app.netdata.cloud"

# ========================================
# Network Binding (Local Dashboard)
# ========================================
# Local dashboards are SECONDARY - for break-glass debugging only
# Cloud is the primary UI, but we keep local access via tailnet
netdata_bind_to_localhost: true
netdata_bind_to_tailscale: true
netdata_web_port: 19999

# ========================================
# Agent Retention Settings
# ========================================
# Each agent stores some local metrics for resilience
# Cloud retains historical data; local is short-term buffer
netdata_memory_mode: dbengine
netdata_dbengine_disk_space_mb: 1024  # 1GB per node (Cloud has history)

# Page cache for dbengine
netdata_page_cache_size_mb: 32

# ========================================
# Resource Constraints (for atom and similar)
# ========================================
# Disable heavy plugins on resource-constrained nodes
netdata_lightweight_mode: false

# Plugins to disable on lightweight nodes
netdata_disabled_plugins_lightweight:
  - apps
  - cgroups
  - tc
  - idlejitter
  - perf

# ========================================
# Installation Settings
# ========================================
# Release channel: 'stable' (default) or 'nightly'
netdata_channel: stable

# Kickstart script URL (used for installation and claiming)
netdata_kickstart_url: "https://get.netdata.cloud/kickstart.sh"

# Windows MSI installer URL
netdata_windows_msi_url: "https://github.com/netdata/netdata/releases/latest/download/netdata-x64.msi"

# macOS installation via Homebrew
netdata_macos_use_homebrew: true

# ========================================
# Windows Agent Settings
# ========================================
# With Homelab subscription, Windows agents have FULL functionality:
#   - Local UI works (not locked)
#   - Cloud integration works fully
#   - All metrics visible in Cloud dashboard
#
# Default is now TRUE - Homelab unlocks Windows agents
netdata_enable_windows_agent: true

# ========================================
# Service Management
# ========================================
netdata_service_name: netdata
netdata_service_enabled: true
netdata_service_state: started

# ========================================
# Firewall Configuration
# ========================================
# Open port only for Tailscale access (local dashboard)
netdata_configure_firewall: true

# Tailscale CGNAT range for firewall rules
netdata_tailscale_cidr: "100.64.0.0/10"

# ========================================
# Collector Settings
# ========================================
# Control which collectors are enabled per node.
# These affect go.d.conf and related collector configs.

# Container monitoring (cgroups.plugin) - monitors Podman/Docker containers
# Works automatically via /sys/fs/cgroup on Linux
netdata_enable_containers: true

# LiteLLM Prometheus endpoint collector
# Scrapes /metrics from LiteLLM proxy for request/latency metrics
netdata_enable_litellm_prometheus: false
netdata_litellm_metrics_url: "http://127.0.0.1:4000/metrics"

# Nvidia GPU monitoring (nvidia_smi collector via go.d.plugin)
# Requires nvidia-smi CLI and NVIDIA drivers installed
netdata_enable_nvidia_gpu: false

# Linux hardware sensors (sensors collector via go.d.plugin)
# Uses lm-sensors/sysfs to auto-detect temps, fans, voltages
netdata_enable_linux_sensors: true

# ========================================
# DEPRECATED - Parent/Child Streaming
# ========================================
# These settings are NO LONGER USED - kept for reference only
# Netdata Cloud replaces the local parent/child topology
#
# netdata_role: deprecated - all nodes are standalone agents
# netdata_parent_host: deprecated - Cloud is the aggregator
# netdata_stream_api_key: deprecated - no streaming needed
