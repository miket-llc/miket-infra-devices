# Copyright (c) 2025 MikeT LLC. All rights reserved.

# Ansible Inventory for Infrastructure Devices
# Uses Tailscale hostnames for secure connectivity
# Tailnet: pangolin-vega.ts.net

all:
  children:
    linux:
      hosts:
        motoko:
          ansible_connection: local
          ansible_host: localhost
          ansible_user: mdt
          ansible_become: true
          ansible_python_interpreter: /usr/bin/python3
          # GPU specification for motoko
          gpu:
            vendor: NVIDIA
            model: GeForce RTX 2080
            vram_gb: 8
        
        atom:
          ansible_host: atom.pangolin-vega.ts.net
          ansible_user: mdt
          ansible_become: true
          ansible_python_interpreter: /usr/bin/python3
          ansible_password: "{{ lookup('pipe', '/usr/bin/az keyvault secret show --vault-name kv-miket-ops --name atom-ansible-password --query value -o tsv') | trim }}"
          # Resilience node - no GPU compute
          gpu:
            vendor: Intel
            model: HD Graphics 4000
            vram_gb: 0
          
    windows:
      children:
        windows_workstations:
          hosts:
            wintermute:
              ansible_host: wintermute.pangolin-vega.ts.net
              ansible_connection: winrm
              ansible_user: mdt
              ansible_password: "{{ lookup('pipe', '/usr/bin/az keyvault secret show --vault-name kv-miket-ops --name wintermute-ansible-password --query value -o tsv') | trim }}"
              ansible_port: 5985
              ansible_winrm_transport: ntlm
              ansible_winrm_server_cert_validation: ignore
              gpu:
                vendor: NVIDIA
                model: GeForce RTX 4070 Super
                vram_gb: 12
              
            armitage:
              ansible_host: armitage.pangolin-vega.ts.net
              ansible_connection: winrm
              ansible_user: mdt
              ansible_password: "{{ lookup('pipe', '/usr/bin/az keyvault secret show --vault-name kv-miket-ops --name armitage-ansible-password --query value -o tsv') | trim }}"
              ansible_port: 5985
              ansible_winrm_transport: ntlm
              ansible_winrm_server_cert_validation: ignore
              gpu:
                vendor: NVIDIA
                model: GeForce RTX 4070
                vram_gb: 8
          
    macos:
      hosts:
        count-zero:
          ansible_host: count-zero.pangolin-vega.ts.net
          ansible_user: miket
          ansible_become: false  # Explicitly disable global sudo for this host
          # ansible_become_password: "{{ vault_count_zero_sudo_password | default(omit) }}"
          ansible_python_interpreter: /usr/bin/python3
          # Uses Tailscale SSH via ACL - no keys needed

    # ========================================
    # Capability-based Groups
    # ========================================
    
    # GPU capability groups (by VRAM)
    gpu_8gb:
      hosts:
        motoko:
        armitage:

    gpu_12gb:
      hosts:
        wintermute:

    # Wake-on-LAN enabled hosts
    wol_enabled:
      hosts:
        motoko:
        armitage:
        wintermute:

    # ========================================
    # Workstation Groups (have window managers)
    # ========================================
    # These hosts get GUI tools (Cursor, Warp, VS Code)
    
    linux_workstations:
      hosts:
        # Linux desktops/workstations with GUI
        atom:   # Resilience node with GNOME

    windows_workstations:
      hosts:
        wintermute:
        armitage:

    macos_workstations:
      hosts:
        count-zero:

    # Composite group: all workstations (for GUI tools)
    all_workstations:
      children:
        linux_workstations:
        windows_workstations:
        macos_workstations:

    # ========================================
    # Fedora Headless GPU Nodes
    # ========================================
    # Nodes running headless Fedora Server with GPU
    # Configuration: no GUI, lid-closed operation, GPU drivers, containers
    fedora_headless_gpu_nodes:
      hosts:
        motoko:

    # ========================================
    # PSBI Core Infrastructure Nodes
    # ========================================
    # Primary nodes providing PSBI (PHC Storage + Base Infrastructure)
    psbi_core_nodes:
      hosts:
        motoko:

    # ========================================
    # Storage Nodes
    # ========================================
    # Nodes with PHC storage mounts (/space, /flux, /time)
    storage_nodes:
      hosts:
        motoko:

    # ========================================
    # Container Hosts
    # ========================================
    # Nodes running containerized services (Podman or Docker)
    container_hosts:
      hosts:
        motoko:
        wintermute:
        armitage:

    # ========================================
    # AI Nodes (vLLM + LiteLLM)
    # ========================================
    # Nodes capable of running AI workloads (vLLM backends)
    # Includes all hosts with GPUs suitable for inference
    ai_nodes:
      hosts:
        motoko:
        wintermute:
        armitage:

    # ========================================
    # Netdata Monitoring Nodes
    # ========================================
    # Netdata Cloud-centric monitoring (Homelab subscription)
    # All nodes run standalone agents claimed to Cloud via ACLK
    # Cloud is the primary UI; local dashboards are secondary
    # Future: AI node (Minisforum X1) will be added here
    netdata_nodes:
      hosts:
        motoko:
        atom:
        wintermute:
        armitage:
        count-zero:

    # ========================================
    # Remote Desktop Groups
    # ========================================
    # ========================================
    # Resilience Nodes
    # ========================================
    # Battery-backed devices that stay alive during power failures
    # Purpose: Network presence proof, SSH foothold, alert origin
    resilience_nodes:
      hosts:
        atom:

    tailnet_all:
      children:
        linux_servers:
          hosts:
            motoko:
            atom:
        windows_servers:
          hosts:
            wintermute:
            armitage:
        workstations:
          hosts:
            motoko:
            wintermute:
            armitage:
            count-zero:
            atom:

  vars:
    # Global variables for all hosts
    ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
    backup_server: motoko
    docker_registry: ""
