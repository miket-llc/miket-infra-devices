# Copyright (c) 2025 MikeT LLC. All rights reserved.

# Motoko - Primary Infrastructure Server
# Last Updated: 2025-12-05

device:
  hostname: motoko
  fqdn: motoko.pangolin-vega.ts.net
  type: server
  location: primary
  primary_user: mdt
  os: "Fedora 43"
  codename: workstation
  desktop: "GNOME"
  display_server: "X11"

hardware:
  manufacturer: Alienware
  model: Laptop (repurposed as server)
  cpu: "Intel Core i7-8750H"
  gpu: "NVIDIA GeForce RTX 2080"
  gpu_driver: "535.230.02"
  cuda_version: "12.2"
  memory_gb: 32
  storage:
    internal:
      - mount: "/"
        device: nvme1n1p3
        size_gb: 15
        type: LVM on NVMe
      - mount: "/podman"
        device: nvme0n1p3
        size_gb: 951
        type: btrfs on NVMe
        purpose: Container storage
      - mount: "/flux"
        device: sda1
        size_tb: 3.6
        type: ext4 on SATA SSD
        model: "ST4000LM024-2U817V"
        uuid: "1ee5fe43-ad34-418c-a1b9-935daf594413"
        purpose: Runtime/active workspace
    external_usb:
      # Western Digital 20TB Elements USB 3.0 Drive
      # WARNING: USB device names (sdb/sdc/sdd) may drift after reboots!
      # Always use UUIDs in fstab, never device names.
      model: "WDC WD200EDGZ-11BLDS0"
      serial: "STGVU4GW"
      connection: USB 3.0
      total_size_tb: 18.2
      partitions:
        - mount: "/time"
          label: "time"
          size_tb: 7.3
          type: ext4
          uuid: "f54cf57c-e434-45f5-bde3-cc706ffbe849"
          partuuid: "1c9f2b1f-f97c-45d0-984a-bd04a33c2cb2"
          purpose: Time Machine backups (count-zero)
        - mount: "/space"
          label: "space"
          size_tb: 10.9
          type: ext4
          uuid: "7f5e508d-fcac-4d18-80ca-84c857b20b40"
          partuuid: "1eb02297-a2f2-4f97-b630-17321c4685f0"
          purpose: PHC System of Record (SoR)

operating_system:
  os: "Fedora"
  version: "43"
  codename: workstation
  kernel: "6.17"
  desktop_environment: "GNOME"
  display_server: "X11"
  display_manager: "GDM"

network:
  tailscale_enabled: true
  tailscale_tags:
    - "tag:server"
    - "tag:linux"
    - "tag:ansible"
  ssh_enabled: true
  ssh_auth: key_only
  ssh_port: 22

services:
  - Podman (with NVIDIA CDI runtime)
  - Podman Compose
  - LiteLLM Proxy (port 8000)
  - vLLM Embeddings (port 8200)
  - Nextcloud (port 8080)
  - Samba (file sharing)
  - Netatalk (AFP for macOS)
  - fail2ban (security)
  - postfix (mail)
  - NoMachine (port 4000)

vllm:
  reasoning:
    enabled: true
    model: "mistralai/Mistral-7B-Instruct-v0.2-AWQ"
    port: 8001
    container_name: "vllm-reasoning-motoko"
    gpu_memory_utilization: 0.45
    max_model_len: 4096
  embeddings:
    enabled: true
    model: "BAAI/bge-base-en-v1.5"
    port: 8200
    container_name: "vllm-embeddings-motoko"
    gpu_memory_utilization: 0.30

litellm:
  enabled: true
  port: 8000
  container_name: "litellm"
  config_path: "/opt/litellm/litellm.config.yaml"
  routes_to:
    - "Armitage (local/chat)"
    - "Wintermute (local/reasoner)"
    - "Motoko (local/reasoning)"
    - "Motoko (local/embed)"
    - "OpenAI (fallback)"

remote_desktop:
  protocol: nomachine
  port: 4000
  version: "9.2.18"
  display_manager: gdm
  session_type: gnome
  # X11 provides full NoMachine compatibility - no portal limitations

use_cases:
  - Primary Ansible control node
  - Podman container hosting
  - LLM inference (embeddings via vLLM)
  - LLM request routing (LiteLLM proxy)
  - Nextcloud file sync server
  - Backup storage server (Time Machine for count-zero)
  - PHC storage backplane (/space, /flux, /time)
  - File sharing (Samba/AFP)

notes:
  - Primary infrastructure server and Ansible control node
  - Hosts Podman containers with NVIDIA CDI runtime
  - Provides backup services via Samba/AFP
  - Routes LLM requests via LiteLLM proxy
  - GPU: embeddings workload (50% utilization, headroom for future services)
  - Connected to Tailnet for secure remote access
  - Self-managed via Ansible playbooks
  - Docker completely purged 2025-12-03 (Stalin mode)
