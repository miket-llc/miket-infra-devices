# Copyright (c) 2025 MikeT LLC. All rights reserved.

# Motoko - Primary Infrastructure Server
# Last Updated: 2025-11-28

device:
  hostname: motoko
  fqdn: motoko.pangolin-vega.ts.net
  type: server
  location: primary
  primary_user: mdt
  os: "Fedora 43"
  codename: workstation
  desktop: "GNOME"
  display_server: "X11"

hardware:
  manufacturer: Alienware
  model: Laptop (repurposed as server)
  cpu: "Intel Core i7-8750H"
  gpu: "NVIDIA GeForce RTX 2080"
  gpu_driver: "535.230.02"
  cuda_version: "12.2"
  memory_gb: 32
  storage:
    - "/space"  # SoR - 20TB USB 3.0 drive
    - "/flux"   # Runtime surface
    - "/time"   # Time Machine backup target

operating_system:
  os: "Fedora"
  version: "43"
  codename: workstation
  kernel: "6.17"
  desktop_environment: "GNOME"
  display_server: "X11"
  display_manager: "GDM"

network:
  tailscale_enabled: true
  tailscale_tags:
    - "tag:server"
    - "tag:linux"
    - "tag:ansible"
  ssh_enabled: true
  ssh_auth: key_only
  ssh_port: 22

services:
  - Podman (with NVIDIA CDI runtime)
  - Podman Compose
  - LiteLLM Proxy (port 8000)
  - vLLM Embeddings (port 8200)
  - Nextcloud (port 8080)
  - Samba (file sharing)
  - Netatalk (AFP for macOS)
  - fail2ban (security)
  - postfix (mail)
  - NoMachine (port 4000)

vllm:
  reasoning:
    enabled: true
    model: "mistralai/Mistral-7B-Instruct-v0.2-AWQ"
    port: 8001
    container_name: "vllm-reasoning-motoko"
    gpu_memory_utilization: 0.45
    max_model_len: 4096
  embeddings:
    enabled: true
    model: "BAAI/bge-base-en-v1.5"
    port: 8200
    container_name: "vllm-embeddings-motoko"
    gpu_memory_utilization: 0.30

litellm:
  enabled: true
  port: 8000
  container_name: "litellm"
  config_path: "/opt/litellm/litellm.config.yaml"
  routes_to:
    - "Armitage (local/chat)"
    - "Wintermute (local/reasoner)"
    - "Motoko (local/reasoning)"
    - "Motoko (local/embed)"
    - "OpenAI (fallback)"

remote_desktop:
  protocol: nomachine
  port: 4000
  version: "9.2.18"
  display_manager: gdm
  session_type: gnome
  # X11 provides full NoMachine compatibility - no portal limitations

use_cases:
  - Primary Ansible control node
  - Podman container hosting
  - LLM inference (embeddings via vLLM)
  - LLM request routing (LiteLLM proxy)
  - Nextcloud file sync server
  - Backup storage server (Time Machine for count-zero)
  - PHC storage backplane (/space, /flux, /time)
  - File sharing (Samba/AFP)

notes:
  - Primary infrastructure server and Ansible control node
  - Hosts Podman containers with NVIDIA CDI runtime
  - Provides backup services via Samba/AFP
  - Routes LLM requests via LiteLLM proxy
  - GPU: embeddings workload (50% utilization, headroom for future services)
  - Connected to Tailnet for secure remote access
  - Self-managed via Ansible playbooks
  - Docker completely purged 2025-12-03 (Stalin mode)
