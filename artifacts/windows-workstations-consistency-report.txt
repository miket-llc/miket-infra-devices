Windows Workstations Consistency Report
========================================

Date: $(date '+%Y-%m-%d %H:%M:%S')
Status: ✅ REFACTORING COMPLETE

WORKSTATIONS:
------------
- armitage (Alienware laptop, RTX 4070, 8GB VRAM)
- wintermute (Desktop, RTX 4070 Super, 12GB VRAM)

SHARED CONFIGURATION:
--------------------
✅ Inventory Group: windows_workstations (ansible/inventory/hosts.yml)
✅ Shared Variables: ansible/group_vars/windows_workstations/main.yml
✅ Shared Role: windows-vllm-deploy
✅ Shared Playbooks: windows-vllm-deploy.yml, configure-windows-rdp.yml
✅ User Account: mdt (local account only, no Microsoft account)

CONSISTENT CONFIGURATION:
------------------------
1. User Account
   - Both use: mdt (local account)
   - No longer using: mdt_@msn.com Microsoft account
   - Path: C:\Users\mdt\

2. Docker Desktop
   - Backend: WSL2
   - Credential store: Disabled (prevents auth issues)
   - Config: C:\Users\mdt\.docker\config.json
   - NVIDIA Container Toolkit: Enabled in WSL2

3. vLLM Configuration
   - Scripts path: C:\Users\mdt\dev\{hostname}\scripts\
   - Config path: C:\ProgramData\{Hostname}Mode\
   - Container name: vllm-{hostname}
   - Image: vllm/vllm-openai:latest
   - Port: 8000
   - Auto-switch: Enabled (checks every 5 minutes)

4. RDP Configuration
   - Group Policy: Enabled (prevents toggle from reverting)
   - NLA: Enabled
   - Port: 3389
   - Firewall: Restricted to Tailscale subnet (100.64.0.0/10)
   - Access: All administrators have RDP access

5. PowerShell Scripts
   Both machines have:
   - Start-VLLM.ps1
   - Auto-ModeSwitcher.ps1
   - Set-WorkstationMode.ps1

6. Scheduled Tasks
   - Task name: {Hostname} Auto Mode Switcher
   - Run as: SYSTEM
   - Interval: Every 5 minutes

DEVICE-SPECIFIC CONFIGURATION:
------------------------------
Only these settings differ (based on hardware):

| Setting | Armitage | Wintermute |
|---------|----------|------------|
| GPU | RTX 4070 (8GB) | RTX 4070 Super (12GB) |
| Model | Qwen/Qwen2.5-7B-Instruct-AWQ | casperhansen/llama-3-8b-instruct-awq |
| Max Model Len | 16384 | 9000 |
| Max Num Seqs | 1 | (default) |
| GPU Memory Util | 0.85 | 0.88 |
| Form Factor | Laptop | Desktop |

DEPLOYMENT STATUS:
-----------------
✅ armitage: RDP configured, Docker deployed, vLLM container running
✅ wintermute: RDP configured, Docker deployed, vLLM container running

Both machines:
✅ RDP Group Policy configured (toggle won't revert)
✅ Scripts deployed to C:\Users\mdt\dev\{hostname}\scripts\
✅ Docker config updated (credential store disabled)
✅ Scheduled tasks created
✅ vLLM containers running

VERIFICATION COMMANDS:
---------------------
# Check both machines
ansible windows_workstations -i inventory/hosts.yml -m win_ping

# Verify RDP
ansible windows_workstations -i inventory/hosts.yml -m win_shell -a 'Get-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" -Name fDenyTSConnections'

# Verify scripts
ansible windows_workstations -i inventory/hosts.yml -m win_shell -a 'Test-Path "C:\Users\mdt\dev\{{ inventory_hostname }}\scripts\Start-VLLM.ps1"'

# Verify containers
ansible windows_workstations -i inventory/hosts.yml -m win_shell -a 'docker ps --filter name=vllm-{{ inventory_hostname }}'

# Check Docker config
ansible windows_workstations -i inventory/hosts.yml -m win_shell -a 'Get-Content C:\Users\mdt\.docker\config.json'

PLAYBOOK USAGE:
--------------
# Deploy to all Windows workstations
ansible-playbook -i inventory/hosts.yml playbooks/configure-windows-rdp.yml
ansible-playbook -i inventory/hosts.yml playbooks/windows-vllm-deploy.yml

# Deploy to specific workstation
ansible-playbook -i inventory/hosts.yml playbooks/configure-windows-rdp.yml --limit armitage
ansible-playbook -i inventory/hosts.yml playbooks/windows-vllm-deploy.yml -e "target_hosts=wintermute"

API ENDPOINTS:
-------------
- Armitage: http://armitage.pangolin-vega.ts.net:8000/v1
- Wintermute: http://wintermute.pangolin-vega.ts.net:8000/v1

RDP CONNECTIONS:
---------------
- Armitage: armitage.pangolin-vega.ts.net:3389
- Wintermute: wintermute.pangolin-vega.ts.net:3389

DOCUMENTATION UPDATES:
---------------------
✅ Updated: docs/architecture/account-architecture.md
✅ Updated: docs/runbooks/armitage-docker-nvidia-debug.md
✅ Created: ansible/group_vars/windows_workstations/main.yml
✅ Created: docs/WINDOWS_WORKSTATION_CONSISTENCY.md
✅ Updated: ansible/inventory/hosts.yml (added windows_workstations group)
✅ Updated: ansible/playbooks/configure-windows-rdp.yml (targets windows_workstations)
✅ Updated: ansible/playbooks/windows-vllm-deploy.yml (defaults to windows_workstations)
✅ Updated: ansible/roles/windows-vllm-deploy/defaults/main.yml (hardcoded mdt user)

BENEFITS:
--------
1. Single source of truth for Windows workstation configuration
2. Consistent user account (mdt) across both machines
3. Same path structure and file locations
4. Easier to add new Windows workstations
5. No Docker Desktop credential issues
6. Simplified deployment and maintenance

NEXT STEPS:
----------
Both machines are now consistently configured. All deployments should work
seamlessly for both armitage and wintermute using the same playbooks.




